<!DOCTYPE html>
<html lang="fr">
<head>
  <link rel="stylesheet" type="text/css" href="stylezzzzz.css">
  <link rel="stylesheet" type="text/css" href="stylezz2..css">
  <link rel="icon" href="favicon.ico">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <meta charset="UTF-8">
  <title>Détails du Cours</title>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const urlParams = new URLSearchParams(window.location.search);
      const sigle = urlParams.get("sigle");
      const cip = urlParams.get("cip");
      const trimestre = urlParams.get("selectedTrimestre");
      // Utilisez les variables sigle et cip pour afficher les informations du cours spécifique
      document.getElementById("course-name").innerHTML = sigle;


      axios.get('http://localhost:8888/api/selectNotesGraphique/' + cip + '/' + sigle + '/' + trimestre)
              .then(response => {
                let totalPond = 0;
                let totalNotePond = 0;
                const graphData = response.data.map(entry => {
                  totalPond += entry.totalpond;
                  totalNotePond += entry.totalnotepond;
                  const point = {x: totalPond, y: (totalNotePond / totalPond)*100};
                  console.log(point);
                  return point;
                });
                var ctx = document.getElementById('myChart').getContext('2d');
                var chart = new Chart(ctx, {
                  type: 'line',
                  data: {
                    datasets: [{
                      label: 'Evolution de la note',
                      backgroundColor: 'rgb(255, 99, 132)',
                      borderColor: 'rgb(255, 99, 132)',
                      data: graphData
                    }]
                  },
                  options: {
                    legend: {
                      display: false
                    },
                    scales: {
                      x: {
                        type: 'linear', // add this line
                        display: true,
                        title: {
                          display: true,
                          text: 'Ponderation'
                        }
                      },
                      y: {
                        display: true,
                        title: {
                          display: true,
                          text: 'Note moyenne (%)'
                        }
                      }
                    }
                  }
                });
              })
              .catch(err => console.log(err)); // Log errors if any
    });
  </script>
</head>
<body>
<header>
  <img alt="Université de Sherbrooke" src="udes.svg">
  <div class="top-right">Détails du Cours</div>
  <div class="logout-section">
    <button class="logout" role="button" onclick="logout()">Logout</button>
  </div>
</header>

<div style="width:600px; height:400px;">
  <canvas id="myChart"></canvas>
</div>


<div class="nom-cours">Cours : <span id="course-name"></span></div>

<!-- Lien de retour à la page principale -->
<a href="index.html" class="retour">Retour à la page principale</a>

</body>
</html>